import{b as G,c as re,t as C,a as E,d as oe}from"../chunks/Dbj2R7oW.js";import"../chunks/Bx-0Knem.js";import{t as k,h as U,x as Q,P as ne,Q as le,G as V,R as ce,T as de,V as ve,A as fe,W as R,M as ue,X as ge,Y as _e,O as pe,c as T,s as W,b as d,m as Y,g as a,r as p,Z as X,N as me,_ as he}from"../chunks/DhS4ZT9p.js";import{s as ye,e as Z}from"../chunks/BGQCZvVV.js";import{i as B,b as we}from"../chunks/C1gA84Mh.js";import{t as xe,e as I,i as M,s as F,a as J}from"../chunks/B6Dgic8w.js";import{i as be}from"../chunks/DIFcBYoK.js";import{s as Ee,a as K}from"../chunks/DCefe1R8.js";import{o as $e,a as De}from"../chunks/Ds_hnOby.js";import{a as Ce,s as Te}from"../chunks/C2tu5JMx.js";import{b as ke}from"../chunks/DhvumiXS.js";function Re(v,m,h=!1,y=!1,w=!1){var f=v,o="";k(()=>{var i=ne;if(o===(o=m()??"")){U&&Q();return}if(i.nodes_start!==null&&(le(i.nodes_start,i.nodes_end),i.nodes_start=i.nodes_end=null),o!==""){if(U){V.data;for(var l=Q(),$=l;l!==null&&(l.nodeType!==8||l.data!=="");)$=l,l=ce(l);if(l===null)throw de(),ve;G(V,$),f=fe(l);return}var x=o+"";h?x=`<svg>${x}</svg>`:y&&(x=`<math>${x}</math>`);var u=re(x);if((h||y)&&(u=R(u)),G(R(u),u.lastChild),h||y)for(;R(u);)f.before(R(u));else f.before(u)}})}function Ie(v,m,h,y){var w=v.__style;if(U||w!==m){var f=xe(m);(!U||f!==v.getAttribute("style"))&&(f==null?v.removeAttribute("style"):v.style.cssText=f),v.__style=m}return y}var Me=C("<button> </button>"),Ue=C('<div><video autoplay playsinline="" class="rounded shadow transition-transform duration-300 cursor-pointer"></video></div>',2),Ae=C('<img class="h-48 p-1 rounded">'),Le=C('<div><div class="bg-cyan-900 bg-opacity-80 text-white text-sm px-4 py-1 overflow-scroll h-48 rounded-br z-10"><!></div> <!></div>'),qe=C('<div class="w-full flex flex-col gap-2 mt-6"></div>'),He=C('<section class="flex flex-col items-center gap-4 p-4"><div class="flex flex-wrap justify-center gap-2"></div> <div class="flex items-center justify-between gap-4 p-4 text-lg rounded shadow"></div> <!></section>');function Je(v,m){ue(m,!1);const[h,y]=Ee(),w=()=>K(Ce,"$scancount",h),f=()=>K(Te,"$scanner",h);let o=Y([]),i=Y([]),l=[],$=Y(0);const x=async()=>{let e=a(o).filter(s=>s.active&&s.videoEl).map(s=>O(s.videoEl,s.rotation));const t={scan:f(),c:w(),confirmed:"no",image:[...e]};d(i,[...a(i),t]),setTimeout(async()=>{if(Math.random()>.1)t.confirmed="yes",d(i,[...a(i)]),setTimeout(()=>{d(i,a(i).filter(r=>r.c!==t.c)),d(i,a(i).filter(r=>r.scan!==t.scan))},6e3);else{const r=await ke.toDataURL(t.scan,{errorCorrectionLevel:"L",margin:2,scale:8,color:{dark:"#000000",light:"#ffffff"}});t.image.push(r),t.confirmed="error",d(i,[...a(i)])}},3e3)},u=e=>{e.rotation=(e.rotation+90)%360,d(o,[...a(o)])},S=async(e,t=3840,s=2160)=>{e.active||(e.landscape||([t,s]=[s,t]),e.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.device.deviceId},width:{ideal:t},height:{ideal:s}},audio:!1}),e.active=!0,d(o,[...a(o)]),setTimeout(()=>{e.videoEl&&(e.videoEl.srcObject=e.stream)},10))},j=async e=>{e.active?z(e):S(e),d(o,[...a(o)])},z=e=>{var t;(t=e.stream)==null||t.getTracks().forEach(s=>s.stop()),e.stream=null,e.active=!1,e.videoEl&&(e.videoEl.srcObject=null)},O=(e,t=0)=>{if(!e)return null;const s=e.videoWidth,r=e.videoHeight,n=document.createElement("canvas"),c=n.getContext("2d");return t%180===0?(n.width=s,n.height=r):(n.width=r,n.height=s),c?(c.save(),c.translate(n.width/2,n.height/2),c.rotate(t*Math.PI/180),c.drawImage(e,-s/2,-r/2),c.restore(),n.toDataURL("image/png")):null};$e(async()=>{d(i,[]),await navigator.mediaDevices.getUserMedia({video:!0}),l=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"),d(o,l.map(t=>({device:t,stream:null,videoEl:null,active:!1,rotation:0,landscape:!0})))}),De(()=>{a(o).forEach(e=>z(e))}),ge(()=>(w(),a($)),()=>{w()!==a($)&&(d($,w()),x())}),_e(),be();var A=He(),L=T(A);I(L,5,()=>a(o),M,(e,t)=>{var s=Me();let r;var n=T(s);p(s),k(c=>{r=F(s,1,"px-4 py-2 rounded shadow transition",null,r,c),ye(n,`${a(t).device.label||"Unnamed Camera"}
				${a(t).active?"ðŸŸ¢":"âšª"}`)},[()=>({"bg-green-700":a(t).active,"bg-gray-800":!a(t).active,"text-white":!0})],X),Z("click",s,()=>j(a(t))),E(e,s)}),p(L);var q=W(L,2);I(q,5,()=>a(o),M,(e,t,s)=>{var r=oe(),n=me(r);{var c=b=>{var _=Ue(),D=T(_);we(D,(g,H)=>(H.videoEl=g,he(()=>a(o))),g=>g==null?void 0:g.videoEl,()=>[a(t)]),p(_),k(()=>Ie(D,`transform: rotate(${a(t).rotation??""}deg);`)),Z("click",D,()=>u(a(t))),E(b,_)};B(n,b=>{a(t).active&&b(c)})}E(e,r)}),p(q);var ee=W(q,2);{var te=e=>{var t=qe();I(t,5,()=>[...a(i)].reverse(),M,(s,r)=>{let n=()=>a(r).scan,c=()=>a(r).image,b=()=>a(r).confirmed;var _=Le();let D;var g=T(_),H=T(g);Re(H,()=>n().split("").join("<br>")),p(g);var ae=W(g,2);I(ae,1,c,M,(N,se,ie,Ne)=>{var P=Ae();J(P,"alt",`Capture ${ie+1}`),k(()=>J(P,"src",a(se))),E(N,P)}),p(_),k(N=>D=F(_,1,"flex items-center opacity-70 justify-between gap-4 text-lg overflow-hidden overflow-x-scroll rounded-md",null,D,N),[()=>({"bg-emerald-300":b()=="yes","bg-cyan-600":b()=="no","bg-rose-400":b()=="error"})],X),E(s,_)}),p(t),E(e,t)};B(ee,e=>{a(i).length&&e(te)})}p(A),E(v,A),pe(),y()}export{Je as component};
