import{b as G,c as re,t as C,a as E,d as oe}from"../chunks/J3dmLmji.js";import"../chunks/_PeJ6quD.js";import{t as k,h as U,x as Q,P as ne,Q as le,G as V,R as de,T as ce,V as ve,A as fe,W as R,M as ue,X as ge,Y as _e,O as pe,c as T,s as W,b as v,m as Y,g as a,r as p,Z as X,N as me,_ as he}from"../chunks/C7EWuEMJ.js";import{s as ye,e as Z}from"../chunks/DwwRv1Xk.js";import{i as B,b as we}from"../chunks/CaDkz3ZD.js";import{t as xe,e as I,i as M,s as F,a as J}from"../chunks/BrfOpNqp.js";import{i as be}from"../chunks/B0XVCxuX.js";import{s as Ee,a as K}from"../chunks/CE_Lb8p4.js";import{o as $e,a as De}from"../chunks/CLjBRut9.js";import{a as Ce,s as Te}from"../chunks/fGuR-tTc.js";import{b as ke}from"../chunks/DhvumiXS.js";function Re(f,m,h=!1,y=!1,w=!1){var c=f,i="";k(()=>{var r=ne;if(i===(i=m()??"")){U&&Q();return}if(r.nodes_start!==null&&(le(r.nodes_start,r.nodes_end),r.nodes_start=r.nodes_end=null),i!==""){if(U){V.data;for(var l=Q(),$=l;l!==null&&(l.nodeType!==8||l.data!=="");)$=l,l=de(l);if(l===null)throw ce(),ve;G(V,$),c=fe(l);return}var x=i+"";h?x=`<svg>${x}</svg>`:y&&(x=`<math>${x}</math>`);var u=re(x);if((h||y)&&(u=R(u)),G(R(u),u.lastChild),h||y)for(;R(u);)c.before(R(u));else c.before(u)}})}function Ie(f,m,h,y){var w=f.__style;if(U||w!==m){var c=xe(m);(!U||c!==f.getAttribute("style"))&&(c==null?f.removeAttribute("style"):f.style.cssText=c),f.__style=m}return y}var Me=C("<button> </button>"),Ue=C('<div><video autoplay playsinline="" class="rounded shadow transition-transform duration-300 cursor-pointer"></video></div>',2),Ae=C('<img class="h-48 p-1 rounded">'),Le=C('<div><div class="bg-cyan-900 bg-opacity-80 text-white text-sm px-4 py-1 overflow-scroll h-48 rounded-br z-10"><!></div> <!></div>'),qe=C('<div class="w-full flex flex-col gap-2 mt-6"></div>'),He=C('<section class="flex flex-col items-center gap-4 p-4"><div class="flex flex-wrap justify-center gap-2"></div> <div class="flex items-center justify-between gap-4 p-4 text-lg rounded shadow"></div> <!></section>');function Je(f,m){ue(m,!1);const[h,y]=Ee(),w=()=>K(Ce,"$scancount",h),c=()=>K(Te,"$scanner",h);let i=Y([]),r=Y([]),l=[],$=Y(0);const x=async()=>{let e=a(i).filter(s=>s.active&&s.videoEl).map(s=>O(s.videoEl,s.rotation));const t={scan:c(),c:w(),confirmed:"no",image:[...e]};v(r,[...a(r),t]),setTimeout(async()=>{if(Math.random()>.1)t.confirmed="yes",v(r,[...a(r)]),setTimeout(()=>{v(r,a(r).filter(o=>o.c!==t.c))},6e3);else{const o=await ke.toDataURL(c(),{errorCorrectionLevel:"L",margin:2,scale:8,color:{dark:"#000000",light:"#ffffff"}});t.image.push(o),t.confirmed="error",v(r,[...a(r)])}},3e3)},u=e=>{e.rotation=(e.rotation+90)%360,v(i,[...a(i)])},S=async(e,t=3840,s=2160)=>{e.active||(e.landscape||([t,s]=[s,t]),e.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e.device.deviceId},width:{ideal:t},height:{ideal:s}},audio:!1}),e.active=!0,v(i,[...a(i)]),setTimeout(()=>{e.videoEl&&(e.videoEl.srcObject=e.stream)},10))},j=async e=>{e.active?z(e):S(e),v(i,[...a(i)])},z=e=>{var t;(t=e.stream)==null||t.getTracks().forEach(s=>s.stop()),e.stream=null,e.active=!1,e.videoEl&&(e.videoEl.srcObject=null)},O=(e,t=0)=>{if(!e)return null;const s=e.videoWidth,o=e.videoHeight,n=document.createElement("canvas"),d=n.getContext("2d");return t%180===0?(n.width=s,n.height=o):(n.width=o,n.height=s),d?(d.save(),d.translate(n.width/2,n.height/2),d.rotate(t*Math.PI/180),d.drawImage(e,-s/2,-o/2),d.restore(),n.toDataURL("image/png")):null};$e(async()=>{v(r,[]),await navigator.mediaDevices.getUserMedia({video:!0}),l=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput"),v(i,l.map(t=>({device:t,stream:null,videoEl:null,active:!1,rotation:0,landscape:!0})))}),De(()=>{a(i).forEach(e=>z(e))}),ge(()=>(w(),a($)),()=>{w()!==a($)&&(v($,w()),x())}),_e(),be();var A=He(),L=T(A);I(L,5,()=>a(i),M,(e,t)=>{var s=Me();let o;var n=T(s);p(s),k(d=>{o=F(s,1,"px-4 py-2 rounded shadow transition",null,o,d),ye(n,`${a(t).device.label||"Unnamed Camera"}
				${a(t).active?"ðŸŸ¢":"âšª"}`)},[()=>({"bg-green-700":a(t).active,"bg-gray-800":!a(t).active,"text-white":!0})],X),Z("click",s,()=>j(a(t))),E(e,s)}),p(L);var q=W(L,2);I(q,5,()=>a(i),M,(e,t,s)=>{var o=oe(),n=me(o);{var d=b=>{var _=Ue(),D=T(_);we(D,(g,H)=>(H.videoEl=g,he(()=>a(i))),g=>g==null?void 0:g.videoEl,()=>[a(t)]),p(_),k(()=>Ie(D,`transform: rotate(${a(t).rotation??""}deg);`)),Z("click",D,()=>u(a(t))),E(b,_)};B(n,b=>{a(t).active&&b(d)})}E(e,o)}),p(q);var ee=W(q,2);{var te=e=>{var t=qe();I(t,5,()=>[...a(r)].reverse(),M,(s,o)=>{let n=()=>a(o).scan,d=()=>a(o).image,b=()=>a(o).confirmed;var _=Le();let D;var g=T(_),H=T(g);Re(H,()=>n().split("").join("<br>")),p(g);var ae=W(g,2);I(ae,1,d,M,(N,se,ie,Ne)=>{var P=Ae();J(P,"alt",`Capture ${ie+1}`),k(()=>J(P,"src",a(se))),E(N,P)}),p(_),k(N=>D=F(_,1,"flex items-center opacity-70 justify-between gap-4 text-lg overflow-hidden overflow-x-scroll rounded-md",null,D,N),[()=>({"bg-emerald-300":b()=="yes","bg-cyan-600":b()=="no","bg-rose-400":b()=="error"})],X),E(s,_)}),p(t),E(e,t)};B(ee,e=>{a(r).length&&e(te)})}p(A),E(f,A),pe(),y()}export{Je as component};
